## Вступление
EN: Moodle testpage parser and formatter. These things are for local use, but some pieces of code can be useful for broader masses (e.g. simple quiz test export to [Anki](http://ankisrs.net)).

RU: Парсер для тестов [Moodle](https://ru.wikipedia.org/wiki/Moodle). Ориентирован на студентов ВГМУ и позволяет извлекать тесты и ответы на них из HTML-страниц сайтов e-vsmu.by и do.vsmu.by. Приятные возможности:

* тесты можно вывести в человекочитаемом формате для печати, в том числе в сокращённом виде для шпаргалки
* тесты можно импортировать в [Anki](http://ankisrs.net) и [MyTestX](http://mytest.klyaksa.net) ([пример](https://github.com/radioxoma/vsmu-scripts/blob/master/tests/mytestx/quiz_unsorted_duplicates.txt)), чтобы проходить тестирование с обучением offline

**У программы нет графического интерфейса.** Её цель - облегчить жизнь опытным пользователям.


## Установка

* [Python 2.7](https://www.python.org/downloads/windows/)
* lxml2 вместе с cssselect, бинарники под MS Windows можно скачать [здесь](http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml).


## Использование

### Получение тестов

Необходимо пройти тест на произвольное количество баллов и сохранить страницу с результатами в файл с расширением `*.htm` (Файл > Сохранить как..., 'Веб-страница, только HTML'). Чтобы отобразить все результаты тестирования Moodle на одной странице, следует добавить к ссылке на страницу с ответами параметр `showall=true`: e-vsmu.by/mod/quiz/review.php?attempt=111111&showall=true

Если HTML-страница не содержит информации о правильных ответах, все варианты будут помечены как неверные.

### Работа с программой

Вывести подробную справку по параметрам:

    $ python testparser.py --help

*Пример 1.* Пропарсить сохранённую браузером страницу с сайта e-vsmu.by и сохранить результат в файл `mytestx.txt`. Его можно читать и печатать; тесты отсортированы по тексту вопроса в алфавитном порядке. Программа выводит сообщение о количестве найденных тестов.

    $ python testparser.py evsmu 495gynecology.htm --to-mytestx mytestx.txt
    495 questions total


*Пример 2.* Объединить несколько страниц тестов с сайта e-vsmu.by, удалить дубликаты и сохранить результат в файл `out.txt`.

    $ python testparser.py evsmu test1.htm test_second.htm etc.htm -u --to-mytestx out.txt

Импорт полученных данных в сторонние программы выходит за рамки данного руководства.


## Работа с исходными рукописными текстами

*Раздел написан для исключительных ситуаций.*

Пакетная конвертация множества документов (например *.doc) в plain text.

    $ libreoffice --headless --convert-to txt:text ./* && cat ./*.txt > catall.txt && mkdir ./out && mv ./*.txt ./out

Изменить кодировку на cp1251 (EOL.в стиле Unix).

    $ iconv -c -f utf-8 -t windows-1251 > win.txt

### Регулярные выражения

Выделить текстовые блоки с заданным в `{}` числом строк, отделённые друг от друга хотя бы одной пустой строкой `(^.+?\n){7}`.
Удалить двойные переносы строк `^$`.

    $ sed -r -e "s/^[0-9]{1,3}. /#/g" test.txt | sed -r -e "s/^.\+[0-9]. /+ /g" | sed -r -e "s/^.\-[0-9]. /- /g"
    Идеальный код:
    $ sed -r -e "s/^[0-9]{1,3}. /#/g; s/^.\+[0-9]. /+ /g; s/^.\-[0-9]. /- /g" test.txt
    Код, соответствующий нашим реалиям:
    # Удалим лишние пробелы в тексте
    $ sed -r -e "s/ {1,9}/ /g" test.txt
    # Заменим номер вопроса на октоторп
    $ sed -r -e "s/^ *[0-9]{1,3}. /#/g"
    # Оставим только "+" и "-".
    $ sed -r -e "s/^ *\+[0-9] */+ /g"

    # Топографическая анатомия, дерматовенерология (удаляет также и лишние номера вопросов)
    $ cat in.txt | sed -r -e "s/ {1,9}/ /g; s/^ *[0-9]{1,3}.[0-9]*/#/g; s/^ *\+[0-9][. ]*/+ /g; s/^ *\-[0-9][. ]*/- /g; /^\s*$/d; /#/{x;p;x;}" > out.txt

    # Без удаления номеров вопросов
    $ cat in.txt | sed -r -e "s/ {1,9}/ /g; s/^ *[0-9]{1,3}. /#/g; s/^ *\+[0-9][. ]*/+ /g; s/^ *\-[0-9][. ]*/- /g; /^\s*$/d; /#/{x;p;x;}" > out.txt


## Желаемый функционал

* Группировка тестов по количеству правильных ответов
* В скольки тестах "всё верно" является правильным ответом
* В скольки тестах самый длинный ответ является правильным ответом

*Оценка генеральной совокупности по набору выборок*

* Генеральная совокупность числом K.
* Все элементы разные и их можно сравнивать.
* Можно получить произвольное количество выборок объёмом 100.

Цель: определить размер K генеральной совокупности.
